<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Socket.IO Test</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        #container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #messageList {
            flex: 0.8;
            overflow-y: scroll;
        }
        #inputArea {
            flex: 0.2;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        #inputArea img {
            border-radius: 50%;
            width: 50px;
            height: 50px;
        }
        .like-button, .unlike-button {
            background: transparent;
            border: none;
        }
        .like-button:before, .unlike-button:before {
            content: '❤️';
            font-size: 1.2em;
        }
    </style>
</head>
<body>
<h1>Socket.IO Test</h1>
<div id="container">
    <ul id="messageList"></ul>
    <div id="inputArea">
        <img id="avatar" src="" alt="User Avatar">
        <span id="username"></span>
        <input type="text" id="messageInput" placeholder="Enter your message">
        <button onclick="createMessage()">Send</button>
    </div>
</div>

<script>
    var socket = io.connect('http://localhost:5000');
    var username = 'testuser';  // Replace with the actual username
    var avatarUrl = 'test';  // Replace with the actual avatar URL
    document.getElementById('username').textContent = username;
    document.getElementById('avatar').src = avatarUrl;

    socket.on('connect', function () {
        console.log('Connected to server');
        socket.emit('join', {room: 'room'});  // Join the 'room' room
    });

    socket.on('create message', function (data) {
        console.log('New message received:', data);
        var messageList = document.getElementById('messageList');
        var newMessage = document.createElement('li');
        newMessage.textContent = data.username + ': ' + data.content;

        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = function () {
            deleteMessage(data.message_id);
        };
        newMessage.appendChild(deleteButton);

        var editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            var newContent = prompt('Enter new message content');
            if (newContent) {
                updateMessage(data.message_id, newContent);
            }
        };
        newMessage.appendChild(editButton);

        var commentButton = document.createElement('button');
        commentButton.textContent = 'Comment';
        commentButton.onclick = function () {
            var content = prompt('Enter your comment');
            if (content) {
                createComment(data.message_id, content);
            }
        };
        newMessage.appendChild(commentButton);

        var commentList = document.createElement('ul');
        commentList.id = 'commentList' + data.message_id;
        newMessage.appendChild(commentList);

        var likeButton = document.createElement('button');
        likeButton.className = 'like-button';
        likeButton.onclick = function () {
            likeMessage(data.message_id);
        };
        newMessage.appendChild(likeButton);

        var unlikeButton = document.createElement('button');
        unlikeButton.className = 'unlike-button';
        unlikeButton.onclick = function () {
            removeLikeMessage(data.message_id);
        };
        newMessage.appendChild(unlikeButton);

        messageList.appendChild(newMessage);
        console.log('Message added to list:', newMessage.textContent);  // New log statement
    });

    socket.on('create comment', function (data) {
        console.log('New comment received:', data);
        var commentList = document.getElementById('commentList' + data.message_id);
        var newComment = document.createElement('li');
        newComment.textContent = data.username + ': ' + data.content;

        var deleteCommentButton = document.createElement('button');
        deleteCommentButton.textContent = 'Delete Comment';
        deleteCommentButton.onclick = function () {
            deleteComment(data.comment_id);
        };
        newComment.appendChild(deleteCommentButton);

        var editCommentButton = document.createElement('button');
        editCommentButton.textContent = 'Edit Comment';
        editCommentButton.onclick = function () {
            var newContent = prompt('Enter new comment content');
            if (newContent) {
                updateComment(data.comment_id, newContent);
            }
        };
        newComment.appendChild(editCommentButton);

        var subcommentButton = document.createElement('button');
        subcommentButton.textContent = 'Subcomment';
        subcommentButton.onclick = function () {
            var content = prompt('Enter your subcomment');
            if (content) {
                createSubcomment(data.comment_id, content);
            }
        };
        newComment.appendChild(subcommentButton);

        var subcommentList = document.createElement('ul');
        subcommentList.id = 'subcommentList' + data.comment_id;
        newComment.appendChild(subcommentList);

        commentList.appendChild(newComment);
    });

    socket.on('create subcomment', function (data) {
        console.log('New subcomment received:', data);
        var subcommentList = document.getElementById('subcommentList' + data.comment_id);
        var newSubcomment = document.createElement('li');
        newSubcomment.textContent = data.username + ': ' + data.content;

        var deleteSubcommentButton = document.createElement('button');
        deleteSubcommentButton.textContent = 'Delete Subcomment';
        deleteSubcommentButton.onclick = function () {
            deleteSubcomment(data.subcomment_id);
        };
        newSubcomment.appendChild(deleteSubcommentButton);

        var editSubcommentButton = document.createElement('button');
        editSubcommentButton.textContent = 'Edit Subcomment';
        editSubcommentButton.onclick = function () {
            var newContent = prompt('Enter new subcomment content');
            if (newContent) {
                updateSubcomment(data.subcomment_id, newContent);
            }
        };
        newSubcomment.appendChild(editSubcommentButton);

        subcommentList.appendChild(newSubcomment);
    });

    function createMessage() {
        var messageInput = document.getElementById('messageInput');
        var messageData = {
            user_id: 123,  // Replace with the actual user ID
            username: username,
            avatar_url: avatarUrl,
            content: messageInput.value
        };

        console.log('Sending message:', messageData);  // New log statement
        socket.emit('create message', messageData);
        messageInput.value = '';  // Clear the input field
    }

    function deleteMessage(messageId) {
        var messageData = {
            user_id: 123,  // Replace with the actual user ID
            message_id: messageId
        };

        console.log('Deleting message:', messageData);
        socket.emit('delete message', messageData);
    }

    function updateMessage(messageId, newContent) {
        var messageData = {
            user_id: 123,  // Replace with the actual user ID
            message_id: messageId,
            new_content: newContent
        };

        console.log('Updating message:', messageData);
        socket.emit('update message', messageData);
    }

    function createComment(messageId, content) {
        var commentData = {
            user_id: 123,  // Replace with the actual user ID
            message_id: messageId,
            content: content
        };

        console.log('Creating comment:', commentData);
        socket.emit('create comment', commentData);
    }

    function deleteComment(commentId) {
        var commentData = {
            user_id: 123,  // Replace with the actual user ID
            comment_id: commentId
        };

        console.log('Deleting comment:', commentData);
        socket.emit('delete comment', commentData);
    }

    function updateComment(commentId, newContent) {
        var commentData = {
            user_id: 123,  // Replace with the actual user ID
            comment_id: commentId,
            new_content: newContent
        };

        console.log('Updating comment:', commentData);
        socket.emit('update comment', commentData);
    }

    function createSubcomment(commentId, content) {
        var subcommentData = {
            user_id: 123,  // Replace with the actual user ID
            comment_id: commentId,
            content: content
        };

        console.log('Creating subcomment:', subcommentData);
        socket.emit('create subcomment', subcommentData);
    }

    function deleteSubcomment(subcommentId) {
        var subcommentData = {
            user_id: 123,  // Replace with the actual user ID
            subcomment_id: subcommentId
        };

        console.log('Deleting subcomment:', subcommentData);
        socket.emit('delete subcomment', subcommentData);
    }

    function updateSubcomment(subcommentId, newContent) {
        var subcommentData = {
            user_id: 123,  // Replace with the actual user ID
            subcomment_id: subcommentId,
            new_content: newContent
        };

        console.log('Updating subcomment:', subcommentData);
        socket.emit('update subcomment', subcommentData);
    }

    function likeMessage(messageId) {
        var likeData = {
            user_id: 123,  // Replace with the actual user ID
            message_id: messageId
        };

        console.log('Liking message:', likeData);
        socket.emit('like message', likeData);
    }

    function removeLikeMessage(messageId) {
        var likeData = {
            user_id: 123,  // Replace with the actual user ID
            message_id: messageId
        };

        console.log('Removing like from message:', likeData);
        socket.emit('remove like message', likeData);
    }
</script>
</body>
</html>
